<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
    <link href="workspace.css" rel="stylesheet"></link>
            <!-- 
          MAIN DATA STRUCTURES
        
            Tune
              lines[]
                staffs[]
                   voices[]

            Printer
              layouter  Layout {}
              staffgroups[] Staffgroup {}

            Layout 
              Staffgroup {}
                 voices[]
                   beams[]
                   children[]
                   otherchildren[]
                   stave {}

            stave {}
               y
               top
               bottom
               highest
               lowest
        
           DONE:
             Verificar o transporte de keys com modos min e maj
             Verificar os limites máximo e mínimos para transporte de keys
             Ignorar Accents na transposição
             Tablatura: gerar mesmo sem o baixo
             Layout:    Revisar a impressão dos elementos ending, accents e lyrics
             Layout:    Revisar a de linhas de texto, quando há mais de uma linha
             Tablatura: imprimir os de pausas adequadamente no baixo
             Tablatura: parse
                tratar numeros hexa
                tratar a adicao de pausas - continuacao
                tratar acordes
                tratar startChar e endChar
                registar o parse da tablatura
                gerar a linha durante a inferencia
                imprimir baseado na linha existente
        
           TODO:
             Tablatura: 
                tratar adequadamente os acordes (de baixo)      
                promover a inversão do fole se a posição do botao for melhor
                melhorar a relação open/close do fole na melodia
                revisar a impressão de múltiplas notas na mesma coluna
        
        -->
	<title>Draw The Dots: Tune Editor demo</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"></meta>
    </head>
    <body>

	<script type="text/javascript" src="proto_noconflict.js" ></script>
	<script type="text/javascript" src="jquery-1.10.2.min.js" ></script>

        <script type="text/javascript" src="data/abc_tune.js" ></script>
	<script type="text/javascript" src="api/abc_tunebook.js" ></script>
        <script type="text/javascript" src="midi/abc_midiwriter.js" ></script>

        <script type="text/javascript" src="write/raphael.js" ></script>
	<script type="text/javascript" src="write/sprintf.js" ></script>
        <script type="text/javascript" src="write/abc_glyphs.js" ></script>
        <script type="text/javascript" src="write/abc_graphelements.js" ></script>
        <script type="text/javascript" src="write/abc_layout.js" ></script>
        <script type="text/javascript" src="write/abc_write.js" ></script>

        <script type="text/javascript" src="parse/abc_parse_header.js" ></script>
	<script type="text/javascript" src="parse/abc_tokenizer.js" ></script>
	<script type="text/javascript" src="parse/abc_parse_key_voice.js" ></script>
	<script type="text/javascript" src="parse/abc_parse_directive.js" ></script>
        <script type="text/javascript" src="parse/abc_parse.js" ></script>
        <script type="text/javascript" src="parse/abc_transport.js" ></script>
	<script type="text/javascript" src="parse/abc_common.js" ></script>

        <!-- diatonic accordion map -->
        <script type="text/javascript" src="diatonic/diatonic-map.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.gc.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.clubIIIM.br.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.clubIIIM.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.coronaII.js"></script>
        
        <!-- support for diatonic accordion tablature -->
        <script type="text/javascript" src="tablature/accordion_map.js"></script>
        <script type="text/javascript" src="tablature/accordion_infer.js"></script>
        <script type="text/javascript" src="tablature/accordion_parse.js"></script>
        <script type="text/javascript" src="tablature/accordion_layout.js"></script>
        
 	<script type="text/javascript" src="edit/abc_editor.js" ></script>

        <!--applet id="MIDIPlugin" code="MIDIPlugin.class" name="MIDIPlugin" archive="http://dl.dropbox.com/u/223827/abcjs/MIDIPlugin.jar" height="1" width="1"></applet-->
        <!--applet id="MIDIPlugin" code="MIDIPlugin.class" name="MIDIPlugin" archive="MIDIPlugin.jar" height="2" width="1"></applet-->
        <!--textarea id="target" cols="80" rows="15"></textarea-->

<div id="editControl"> 
           
<textarea id="abcx" cols="120" rows="10" style="display:none; float:left; width: 1110px">
%%scale 1.0
X:1
L:1/8
M:2/4
V:melodia
K:E treble
|: [c2e2g2] [g2b2d'2]| e2e'3 :|: e2e'2 :| 
V:baixo
K:E bass
|: G,2 C,2 | E,2[E,2G,2B,2] :|: E,2z3 :| 
V:tablatura
K: none accordionTab
|: G+[6'7'8']2 C+[8'ab]2 | E+7'2 e+a'2 z+> :|: E+7'2 z+a'2 z+z :|
</textarea>

<textarea id="abcx" cols="120" rows="10" style="display:none; float:left;">
%%scale 1.0
X:1
T:J'ai vu le loup, le renard et la belette
T:Eu vi o lobo, a raposa e a doninha
C:Tradicional 
C:(transcrição: Bernard Loffet)
Q:"Allegro" 1/4=164
L:1/8
M:2/4
%|: c2BA | c2B2 | c-cB2 |
%|: C,2[C,2E,2G,2] | C,[G,,B,,D,] C,[G,,B,,D,] | G,,2[G,,2B,,2D,2] |
V:melodia
K:G treble
|: G2FE | D2EF |  GFGA |  B2G2  | G2FE | D2EF | G2A2 | G2z2  :|
%(Chorus)
w:J'ai vu le loup la re-na-rd la ba-le-tte J'ai  vu le loup la  re-nard dan-ser
|: G2A2 | B2c2 | B2A2 | B2z2 | G2GF | E2ED | E2F2 |1 E2D2 :|2 G2z2  | 
w:Je les ai vue taper leurs mains Je les ai vue ta-per le-urs ma-ins pieds
%Je les ai vue taper leurs pieds
%Je les ai vue taper leurs pieds
%(Chorus 2x)
%Je les ai vue qu'ils s’embrassaient
%Je les ai vue qu'ils s’embrassaient
%Je les ai vue qu'ils se caressaient
%Je les ai vue qu'ils se caressaient
%(Chorus 2x)
%Je les ai vue avec une enfant
%Je les ai vue avec une enfant
%Merci bon dieu c'était pas la mienne
%Merci bon dieu c'était pas la mienne
V:baixo
K:G bass
|: G,,2[G,,2B,,2D,2] | G,,2[D,,2F,,2A,,2] | D,,2[D,,2F,,2A,,2] | G,,2[G,,2B,,2D,2] | G,,2[G,,2B,,2D,2] \
| C,,2[C,,2E,,2G,,2] | D,,2[D,,2F,,2A,,2] | G,,2[G,,2B,,2D,2] :|
|: G,,2[G,,2B,,2D,2] | C,,2[C,,2E,,2G,,2] | D,,2[D,,2F,,2A,,2] | G,,2[G,,2B,,2D,2] | G,,2[G,,2B,,2D,2] \
| C,,2[C,,2E,,2G,,2] | C,,2[C,,2E,,2G,,2] | D,,2[D,,2F,,2A,,2] :| G,,2[G,,2B,,2D,2] |
V:tablatura
K:none accordionTab
</textarea>
       
<textarea id="abc" cols="120" rows="10" style="display:true; float:left;">
X:1
T:Maitia, nun zira?
C:Folclore Basco
C:versão de José Uruñuela.
N:Transcrito por Flávio
L:1/8
Q:"Allegro" 1/4=118
M:6/8
K:G
V:melodia
|z4zB |: B2A A2G | G3-Gz A | B2B B2c | d3 d2B | A2A A2B | c3 B2B |
w:Mai ti a nun zi ra * Nik et zu tuk i kuz ten ez be ti rik ja ki ten Nu
| B2A (AG)F |1 G6 | z4 z B :|2 G6 | d3 efg | B3 A3 | G6 | z4zd |
w:rat gal du * zi ra 
|: g2g g2f | e3 e3 | fga f2e | d4zc | B2B B2c | d3 d2B | A2A A2B |
| c3 B2B | B2A AGF |1 G4zd :|2 G6 | d3 efg | B3 A3 | G6 | z4zB |
%V:baixo
%K:G bass
%|z6  |: z6  | z6  | z6  | z6  | z6  | z6 |
%| z6 |1 z6  | z6  :|2 z6  | z6  | z6  | z6  | z6  |
%|: z6  | z6  | z6  | z6  | z6  | z6  | z6  |
%| z6  | z6  |1 z6  :|2 z6  | z6  | z6  | z6  | z6  |
V:tablatura
K:none accordionTab
| +z4 +z +8 |: +82 -8 -82 -6' | -6'3 -> -z -8 | +82 +8 +82 +7' | +93 -8'2 -7' | -82 +8 +82 +7' | -8'3 -92 -9 |
| +7'2 +8 +8 +6' +7 |1 -86 | -z4 -z -9 :|2 -86 | +8'3 -b -a' +9' | +7'3 +83 | +6'6 | +z4 -z -9' |
|: +9'2 +9' +9'2 +a | -b3 -b3 | -a' +9' +b +a2 -b | -9'4 -z -8' | -92 +7' +7'2 -8' | -9'3 -9'2 -9 | -7'2 +8 +82 +7' |
| -8'3 -92 -9 | -92 -7' +8 +6' +7 |1 +6'4 +z -9' :|2 -86 | -9'3 -b -a' +9' | +7'3 +83 | +6'6 | +z4 -z -9 |
</textarea>
        <select id="selGaitas" ></select>
        <select id="selKey" ></select>
        <input type="submit" id="maisOitava" value="+ Oitava" onclick="javascript:doTranspose(12);" />
        <!--input type="submit" id="maisMeioTom" value="+ 1/2 Tom" onclick="javascript:doTranspose(1);" />
        <input type="submit"  id="nenosMeioTom" value="- 1/2 Tom" onclick="javascript:doTranspose(-1);" /-->
        <input type="submit" id="menosOitava" value="- Oitava" onclick="javascript:doTranspose(-12);" />
        <input type="button" id="printBtn" value="Print Preview" />
        <input type="button" id="renderBtn" value="Render" />
        <input type="submit" id="forceRefresh" value="Refresh" onclick="javascript:doForceRefresh();" />
        <input type="checkbox" id="chkAutoRefresh" />Auto refresh 
        <input type="checkbox" id="chkDebug" onclick="javascript:doCheckDebug();" />Debug
        
        </div>
        
        <div id="warnings"></div>
        <div id="midi"></div>
        <div id="canvas" style="overflow-y: scroll; float:left;"></div>
        
        <div id="renderDiv" style="float:left; display:none;">
           <input type="button" id="renderCloseBtn" value="Back" />
           <div id="renderCanvas" style="overflow-y: scroll; float:left;"></div>
        </div>   

        <script type="text/javascript">
            window.myEditor = {};
            window.printButton = document.getElementById("printBtn");
            window.renderButton = document.getElementById("renderBtn");
            window.renderCloseButton = document.getElementById("renderCloseBtn");
            
            window.addEventListener('load', initApp, false);

            function initApp() {

                debug = false;

                myEditor = new ABCJS.Editor(
                        "abc", {
                            canvas_id: "canvas"
                                    //,midi_id: "midi"
                            , warnings_id: "warnings"
                            , refreshController_id: "chkAutoRefresh"
                            , accordionSelector_id: "selGaitas"
                            , keySelector_id: "selKey"
                            , midi_options: {program: 21, qpm: 150, type: "qt"}
                            , render_options: {}
                            , gui: false
                        });


                        
                printButton.addEventListener("click", function() {
                    document.getElementById("editControl").style.display = "none";
                    window.print();
                    document.getElementById("editControl").style.display = "inline";
                }, false);
                
                renderButton.addEventListener("click", function() {
                    document.getElementById("editControl").style.display = "none";
                    document.getElementById("canvas").style.display = "none";
                    document.getElementById("renderDiv").style.display = "inline";
                    myEditor.renderTune(myEditor.accordion.accordions[0].songs["Maitia, nun zira?"], {}, "renderCanvas");
                }, false);
                
                renderCloseButton.addEventListener("click", function() {
                    document.getElementById("renderDiv").style.display = "none";
                    document.getElementById("canvas").style.display = "inline";
                    document.getElementById("editControl").style.display = "inline";
                }, false);
            }

            function doTranspose(value) {
                myEditor.fireChanged(value, "force");
            };

            function doForceRefresh() {
                myEditor.fireChanged(0, "force");
            };

            function doCheckDebug() {
                debug = document.getElementById("chkDebug").checked;
                myEditor.fireChanged(0, "force");
            };

        </script>

    </body>
</html>
