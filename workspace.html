<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
    <link href="workspace.css" rel="stylesheet"></link>
            <!-- 
          MAIN DATA STRUCTURES
        
            Tune
              lines[]
                staffs[]
                   voices[]

            Printer
              layouter  Layout {}
              staffgroups[] Staffgroup {}

            Layout 
              Staffgroup {}
                 voices[]
                   beams[]
                   children[]
                   otherchildren[]
                   stave {}

            stave {}
               y
               top
               bottom
               highest
               lowest
        
           DONE:
             Verificar o transporte de keys com modos min e maj
             Verificar os limites máximo e mínimos para transporte de keys
             Ignorar Accents na transposição
             Tablatura: gerar mesmo sem o baixo
             Layout:    Revisar a impressão dos elementos ending, accents e lyrics
             Layout:    Revisar a de linhas de texto, quando há mais de uma linha
             Tablatura: imprimir os de pausas adequadamente no baixo
             Tablatura: parse
                tratar numeros hexa
                tratar a adicao de pausas - continuacao
                tratar acordes
                tratar startChar e endChar
                registar o parse da tablatura
                gerar a linha durante a inferencia
                imprimir baseado na linha existente
        
           TODO:
             Tablatura: 
                tratar adequadamente os acordes (de baixo)      
                promover a inversão do fole se a posição do botao for melhor
                melhorar a relação open/close do fole na melodia
                revisar a impressão de múltiplas notas na mesma coluna
        
        -->
	<title>Draw The Dots: Tune Editor demo</title>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"></meta>
    </head>
    <body>

	<script type="text/javascript" src="proto_noconflict.js" ></script>
	<script type="text/javascript" src="jquery-1.10.2.min.js" ></script>

        <script type="text/javascript" src="data/abc_tune.js" ></script>
	<script type="text/javascript" src="api/abc_tunebook.js" ></script>
        <script type="text/javascript" src="midi/abc_midiwriter.js" ></script>

        <script type="text/javascript" src="write/raphael.js" ></script>
	<script type="text/javascript" src="write/sprintf.js" ></script>
        <script type="text/javascript" src="write/abc_glyphs.js" ></script>
        <script type="text/javascript" src="write/abc_graphelements.js" ></script>
        <script type="text/javascript" src="write/abc_layout.js" ></script>
        <script type="text/javascript" src="write/abc_write.js" ></script>

        <script type="text/javascript" src="parse/abc_parse_header.js" ></script>
	<script type="text/javascript" src="parse/abc_tokenizer.js" ></script>
	<script type="text/javascript" src="parse/abc_parse_key_voice.js" ></script>
	<script type="text/javascript" src="parse/abc_parse_directive.js" ></script>
        <script type="text/javascript" src="parse/abc_parse.js" ></script>
        <script type="text/javascript" src="parse/abc_transport.js" ></script>
	<script type="text/javascript" src="parse/abc_common.js" ></script>

        <!-- diatonic accordion map -->
        <script type="text/javascript" src="diatonic/diatonic-map.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.gc.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.clubIIIM.br.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.clubIIIM.js"></script>
        <script type="text/javascript" src="diatonic/accordion.hohner.coronaII.js"></script>
        
        <!-- support for diatonic accordion tablature -->
        <script type="text/javascript" src="tablature/accordion_map.js"></script>
        <script type="text/javascript" src="tablature/accordion_infer.js"></script>
        <script type="text/javascript" src="tablature/accordion_parse.js"></script>
        <script type="text/javascript" src="tablature/accordion_layout.js"></script>
        
 	<script type="text/javascript" src="edit/abc_editor.js" ></script>

        <!--applet id="MIDIPlugin" code="MIDIPlugin.class" name="MIDIPlugin" archive="http://dl.dropbox.com/u/223827/abcjs/MIDIPlugin.jar" height="1" width="1"></applet-->
        <!--applet id="MIDIPlugin" code="MIDIPlugin.class" name="MIDIPlugin" archive="MIDIPlugin.jar" height="2" width="1"></applet-->
        <!--textarea id="target" cols="80" rows="15"></textarea-->

<div id="editControl" style="display:true; float:left;"> 
           
       
<textarea id="abc" cols="120" rows="10" >
X:1
T:Valsa Sertaneja
T:Introdução
C:Cezar Ferreira
N:Transcrito por Flávio
L:1/8
Q:160
M:3/4
V:melodia
K:F
|: z CDE FG | [F6A6] | z CDE FG | [G6B6] |
| EF GA Bc | [c6e6] | [B2d2] [A2c2] [G2B2] | [A6F6]-|[A4F4] z2 :| 
T:Primeira parte
|[F6A6] | [A6c6] | [G6B6] | [E6G6] |
|[B6d6] |[B2d2] [A2c2] [G2B2] |[A6c6] | [F6A6] | 
|[F6A6]|[A6c6]| [G6B6] | [G2B2] [A2c2] [B2d2] |
|[c4e4] [B2d2] | [A4c4] [G2B2] | [F6A6]- | [F4A4] z2 |: 
T:Segunda Parte
|[f6a6] | [e4g4] [f2a2] |[g6b6]-|[g6b6]|[e6g6] |
|[d4f4][c2e2] | [f6a6]-|[f6a6]|[f6a6]|
|[e4g4] [d2f2] | [c3e3] [c1/2e1/2][c1/2e1/2]-[c2e2] | [B3d3] [B1/2d1/2][B1/2d1/2]-[B2d2] | [A3c3] [A1/2c1/2][A1/2c1/2]-[A2c2] |
|[G3B3] [G1/2B1/2][G1/2B1/2]-[G2B2] |1 [F6A6]-|[F6A6] :|2 z FAc AF |
T:Parte Final
|: fC DE FG | [F6A6] | z CDE FG | [G6B6] | EF GA Bc |
|[c6e6] | [B2d2] [A2c2] [G2B2] |1 [F6A6] :|2 [F2A2] z3/2 [G1/2B1/2] [G2B2] | [FA] z z2 z2 ||
V:baixo
K:F bass
|: z6 | F,2 [F,A,C]z [F,A,C]z | F, z z2 z2 | C,2 [CEG]z [CEG]z |
|C,2 [CEG]z [CEG]z | C,2 [CEG]z [CEG]z | C,2 [CEG]z [CEG]z | F,2 [F,A,C]z [F,A,C]z  | F,2 [F,A,C]z [F,A,C]z :|
|F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z |C,2 [CEG]z [CEG]z |C,2 [CEG]z [CEG]z |
|C,2 [CEG]z [CEG]z |C,2 [CEG]z [CEG]z | F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z |
|F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z |C,2 [CEG]z [CEG]z | C,2 [CEG]z [CEG]z |
|C,2 [CEG]z [CEG]z |C,2 [CEG]z [CEG]z | F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z |: 
|F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z |C,2 [CEG]z [CEG]z |C,2 [CEG]z [CEG]z |C,2 [CEG]z [CEG]z |
|C,2 [CEG]z [CEG]z | F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z |
|F,2 [F,A,C]z D,z |C,2 [CEG]z [CEG]z |B,,2 [B,DF]z [B,DF]z |C,2 [CEG]z [CEG]z |
|C,2 [CEG]z [CEG]z |1 F,2 [F,A,C]z [F,A,C]z | F,2 [F,A,C]z [F,A,C]z :|2 F,2 [F,A,C]z [F,A,C]z |
|: F, z z2 z2 | F,2 [F,A,C]z [F,A,C]z | F, z z2 z2  |C,2 [CEG]z [CEG]z |C,2 [CEG]z [CEG]z |
|C,2 [CEG]z [CEG]z | C,2 [CEG]z [CEG]z |1 F,2 [F,A,C]z [F,A,C]z :|2 F,2 z3/2 [C,1/2E,1/2G,1/2] [C,2E,2G,2] | F, z z2 z2 ||
V:tablatura
K:none accordionTab
</textarea>
        <div id="outrosControles" style="display:true; float:left;">
                <select id="selGaitas" ></select>
            <select id="selKey" ></select>
            <input type="submit" id="maisOitava" value="+ Oitava" onclick="javascript:doTranspose(12);" />
            <!--input type="submit" id="maisMeioTom" value="+ 1/2 Tom" onclick="javascript:doTranspose(1);" />
            <input type="submit"  id="nenosMeioTom" value="- 1/2 Tom" onclick="javascript:doTranspose(-1);" /-->
            <input type="submit" id="menosOitava" value="- Oitava" onclick="javascript:doTranspose(-12);" />
            <input type="button" id="printBtn" value="Print Preview" />
            <input type="submit" id="forceRefresh" value="Refresh" onclick="javascript:doForceRefresh();" />
            <input type="checkbox" id="chkAutoRefresh" />Auto refresh 
            <input type="checkbox" id="chkDebug" onclick="javascript:doCheckDebug();" />Debug
        
            <div id="warnings"></div>
            <div id="midi"></div>
        </div>
    
     </div>
     <div id="canvas" style="overflow-y: scroll; float:left;"></div>
        
        <script type="text/javascript">
            window.myEditor = {};
            window.printButton = document.getElementById("printBtn");
            
            window.addEventListener('load', initApp, false);

            function initApp() {

                debug = false;

                myEditor = new ABCJS.Editor(
                        "abc", {
                            canvas_id: "canvas"
                            ,midi_id: "midi"
                            ,warnings_id: "warnings"
                            ,refreshController_id: "chkAutoRefresh"
                            ,accordionSelector_id: "selGaitas"
                            ,keySelector_id: "selKey"
                            ,midi_options: {program: 21, qpm: 150, type: "qt"}
                            ,render_options: {}
                            ,gui: false
                        });

                        
                printButton.addEventListener("click", function() {
                    document.getElementById("editControl").style.display = "none";
                    window.print();
                    document.getElementById("editControl").style.display = "inline";
                }, false);
                
            }

            function doTranspose(value) {
                myEditor.fireChanged(value, "force");
            };

            function doForceRefresh() {
                myEditor.fireChanged(0, "force");
            };

            function doCheckDebug() {
                debug = document.getElementById("chkDebug").checked;
                myEditor.fireChanged(0, "force");
            };


        </script>

    </body>
</html>
